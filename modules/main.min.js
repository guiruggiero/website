
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="5c4bb89c-a2c0-5e86-a3cf-3a4f5ce31f0e")}catch(e){}}();
async function e(e){return globalThis.location?.href.includes("ngrok")?await import(e.replace(".min.js",".js")):await import(e)}const t=await e("./ui.min.js"),n=await e("./validation.min.js"),o=await e("./firebase.min.js"),r=(await e("./guipt.min.js")).default,s=(await e("./localization.min.js")).default;let a=0,i=0,u=null,l="",d=[],c={};class p extends Error{constructor(e){super(e),this.name="TimeoutError"}}let m=0,g=Date.now();async function h(){0==a&&(u=Date.now()),t.toggleSubmitButton(!1),t.closeKeyboard(),t.toggleInput();const e=t.elements.input?.value;2==i&&t.elements.disclaimer?.remove(),i++;const h=n.sanitizeInput(e),w=n.validateInput(h);if("OK"!==w.assessment){"Too long"==w.assessment&&t.clearInput(),"Empty"!==w.assessment&&(t.chatWindowExpanded||t.expandChatWindow(),t.addMessage("error",w.errorMessage));const n=t.elements.input?.value.trim().length>0;return t.toggleSubmitButton(n),t.toggleInput(),t.inputFocus(),void Sentry.captureException(new Error("Failed validation"),{contexts:{turnDetails:{turnNumber:a+1,userInput:e,userInputLength:e.length,sanitizedInput:h,sanitizedInputLength:h.length,validationResult:w}}})}const I=Date.now();if(I-g>6e4&&(m=0,g=I),m>=5){const n=6e4-(I-g);return t.addMessage("error",s.errorRequestLimit),setTimeout(()=>{t.toggleSubmitButton(!0),t.toggleInput(),t.inputFocus()},n),void Sentry.captureException(new Error("Exceeded rate limit"),{contexts:{sessionDetails:{requestCount:m,turnCount:a+1,lastUserInput:e,lastSanitizedInput:h}}})}m++,t.chatWindowExpanded||t.expandChatWindow(),t.clearInput(),t.addMessage("user",h);const y=t.showLoader();let x={};try{const e=new Promise((e,t)=>{setTimeout(()=>t(new p("Client timeout")),16e3)});x=await Promise.race([r(d,h),e])}catch(n){return y.remove(),n instanceof p||n.message?.includes("timeout")?t.addMessage("error",s.errorTimeout):"errorTooLong"==n.response?.data?t.addMessage("error",s.errorTooLong):"errorForbiddenChars"==n.response?.data?t.addMessage("error",s.errorForbiddenChars):t.addMessage("error",s.errorGeneric),t.populateInput(e),t.toggleSubmitButton(!0),t.toggleInput(),t.inputFocus(),void Sentry.captureException(n,{contexts:{source:n.source||"main.js",axiosRetryCount:n.config?.["axios-retry"]?.retryCount??"N/A",turnDetails:{turnNumber:a+1,userInput:e,sanitizedInput:h,chatID:l},turnHistory:c}})}t.addMessage("bot",x.data,y),a++,d.push({role:"user",parts:[{text:h}]},{role:"model",parts:[{text:x.data}]});const v={user:h,model:x.data};if(1==a)c={[a]:v},l=await o.createLog(u,c);else{c={...c,[a]:v};const e=Number(((Date.now()-u)/6e4).toFixed(2));await o.logTurn(l,a,e,c)}t.changePlaceholder(s.replyPlaceholder),t.toggleInput(),t.inputFocus()}function w(e,t){let n=null;return function(...o){clearTimeout(n),n=setTimeout(()=>e.apply(this,o),t)}}function I(){setTimeout(()=>t.inputPlaceholderAndFocus(),500),t.elements.input?.addEventListener("input",w(()=>{const e=t.elements.input?.value.trim().length>0;t.toggleSubmitButton(e),t.togglePromptPills(!e)},150)),t.elements.submit?.addEventListener("pointerup",h),t.elements.input?.addEventListener("keyup",w(e=>{"Enter"===e.key&&h()},150)),setTimeout(()=>t.displayPromptPills(),1e3)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",I):I();
//# sourceMappingURL=main.min.js.map
//# debugId=5c4bb89c-a2c0-5e86-a3cf-3a4f5ce31f0e
